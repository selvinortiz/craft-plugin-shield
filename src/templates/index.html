{% extends "_layouts/cp" %}

{% set title = "Shield Logs" %}
{% set extraPageHeaderHtml %}
    <a class="btn settings icon" href="{{ url('settings/plugins/shield') }}" title="{{ 'Settings'|t }}"></a>
{% endset %}

{% set name = "Shield" %}
{% set version = "1.0" %}
{% set developer = "Selvin Ortiz" %}
{% set developerUrl = "https://selvinortiz.com" %}

{% set logs = craft.shield.logs %}

{% set content %}
    {% if logs is defined and logs|length %}
        <table class="data grid fullwidth shieldGrid">
            <tr>
                <th>Time</th>
                <th>Email</th>
                <th>Author</th>
                <th colspan="2" style="width: 50%;">Content</th>
            </tr>
            {% for log in logs %}
                <tr class="{{ log.flagged ? 'flagged' : 'clean' }}">
                    <td>
                        {{ log.dateCreated|date('Y/m/d') ~' '~ log.dateCreated|date('H:ia') }}</td>
                    <td>
                        {{ log.email }}</td>
                    <td>
                        {{ log.author }}</td>
                    <td class="typewriter">
                        {{ log.content|nl2br }}</td>
                    <td>
                        <form method="POST">
                            {{ csrfInput() }}
                            <input name="action" type="hidden" value="shield/deleteLog"/>
                            <input type="hidden" name="id" value="{{ log.id }}"/>
                            <button class="btn icon delete" style="margin-top: -4px;" type="submit">Delete</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </table>
        <div class="shieldActionSet">
            <div>
                <form method="POST">
                    {{ csrfInput() }}
                    <input name="action" type="hidden" value="shield/deleteLogs"/>
                    <input name="confirmation" type="hidden" value=""/>
                    <button type="submit" class="btn submit icon">Delete Everything</button>
                    <p>
                        <input name="confirmation" type="checkbox" value="1"/>
                        <span class="introvert">Yes, I want to delete everything!</span>
                    </p>
                </form>
            </div>
        </div>
        {% else %}
        <p>Nothing yet, you have a clean slate for now: )</p>
    {% endif %}

    <div class="shieldSection credits">
        <p>
            &copy;
            {{ "now" | date("Y") }}
            <strong>
                {{ name }}
                <span class="shieldSubtle">({{ version }})</span>
            </strong>
            ❤️ Lovingly crafted by
            <a href="{{- developerUrl -}}" title="@selvinortiz" target="_blank">
                {{- developer -}}</a>
        </p>
    </div>
{% endset %}
